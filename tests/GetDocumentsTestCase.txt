# Kibana test
GET isof-publik/_search
{
  "from": 0,
  "highlight": {
    "fields": {
      "contents": {
        "fragment_size": 300,
        "number_of_fragments": 1
      },
      "headwords": {
        "number_of_fragments": 0
      },
      "text": {
        "number_of_fragments": 0
      },
      "title": {
        "number_of_fragments": 0
      }
    },
    "post_tags": [
      "</span>"
    ],
    "pre_tags": [
      "<span class=\"highlight\">"
    ]
  },
  "query": {
    "bool": {
      "must": [
        {
          "bool": {
            "should": [
              { "match": { "transcriptionstatus": "published" }},
              { "match": { "transcriptionstatus": "accession" }},
              { "match": { "transcriptionstatus": "readytocontribute" }}
            ]
          }
        },
        {
          "bool": {
            "should": [
              { "match": { "publishstatus": "published" }}
            ]
          }
        },
        {
          "bool": {
            "should": [
              {
                "multi_match": {
                  "fields": [
                    "text^2",
                    "search_other",
                    "metadata.value",
                    "title",
                    "contents",
                    "archive.archive",
                    "archive.archive_id",
                    "archive.archive_id_row",
                    "places.name",
                    "places.landskap",
                    "places.county",
                    "places.harad",
                    "persons.name",
                    "id",
                    "headwords",
                    "title"
                  ],
                  "minimum_should_match": "100%",
                  "query": "rompedrag",
                  "type": "best_fields"
                }
              },
              {
                "nested": {
                  "path": "media",
                  "query": {
                    "multi_match": {
                      "fields": ["media.text"],
                      "minimum_should_match": "100%",
                      "query": "rompedrag",
                      "type": "best_fields"
                    }
                  },
                  "inner_hits": {
                    "highlight": {
                      "fields": {
                        "text": {
                          "number_of_fragments": 0
                        }
                      },
                      "pre_tags": ["<span class=\"highlight\">"],
                      "post_tags": ["</span>"]
                    }
                  }
                }
              },
              {
                "nested": {
                  "path": "media",
                  "query": {
                    "nested": {
                      "path": "media.description",
                      "query": {
                        "match": {
                          "media.description.text": {
                            "operator": "and",
                            "query": "rompedrag"
                          }
                        }
                      },
                      "inner_hits": {
                        "highlight": {
                          "fields": {
                            "text": {
                              "number_of_fragments": 0
                            }
                          },
                          "pre_tags": ["<span class=\"highlight\">"],
                          "post_tags": ["</span>"]
                        }
                      }
                    }
                  },
                  "inner_hits": {
                    "name": "media_with_description",
                    "highlight": {
                      "fields": {
                        "description.text": { "number_of_fragments": 0 }
                      },
                      "pre_tags": ["<span class=\"highlight\">"],
                      "post_tags": ["</span>"]
                    },
                      "_source": false
                  }
                }
              },
              {
                "nested": {
                  "path": "media",
                  "query": {
                    "nested": {
                      "path": "media.utterances",
                      "query": {
                        "match": {
                          "media.utterances.text": {
                            "operator": "and",
                            "query": "rompedrag"
                          }
                        }
                      },
                      "inner_hits": {
                        "highlight": {
                          "fields": {
                            "text": {
                              "number_of_fragments": 0
                            }
                          },
                          "pre_tags": ["<span class=\"highlight\">"],
                          "post_tags": ["</span>"]
                        }
                      }
                    }
                  }
                }
              }
            ]
          }
        },
        {
          "bool": {
            "should": [
              { "match": { "materialtype": "arkiv" }}
            ]
          }
        },
        {
          "nested": {
            "path": "media",
            "query": {
              "exists": {
                "field": "media.source"
              }
            }
          }
        },
        {
          "bool": {
            "should": [
              { "match": { "taxonomy.type": "tradark" }}
            ]
          }
        }
      ]
    }
  },
  "size": 100,
  "sort": [
    { "archive.archive_id_row.keyword": "asc" },
    { "archive.page.long": "asc" }
  ],
  "track_total_hits": true
}
